// IP-Port Cache Schema
// Minimal schema for API and LLM response caching
// Actual response data stored on file system, DB holds metadata only

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================================================
// API REQUEST CACHE
// Caches responses from USPTO, PatentsView, PTAB, and other external APIs
// =============================================================================

model ApiRequestCache {
  id            Int       @id @default(autoincrement())

  // Request identification (composite unique key)
  endpoint      String    @db.VarChar(50)    // patentsview, file-wrapper, ptab
  requestType   String    @map("request_type") @db.VarChar(50)  // patent, citations, application, ipr
  requestKey    String    @map("request_key") @db.VarChar(100)  // patent_id, application_number, etc.

  // File reference (actual data on disk)
  filePath      String    @map("file_path") @db.VarChar(255)  // relative path from cache/
  fileSize      Int?      @map("file_size")   // bytes

  // Status
  statusCode    Int       @default(200) @map("status_code")
  errorMessage  String?   @map("error_message") @db.VarChar(255)

  // Timestamps
  createdAt     DateTime  @default(now()) @map("created_at")

  @@unique([endpoint, requestType, requestKey])
  @@index([endpoint, requestType])
  @@map("api_request_cache")
}

// =============================================================================
// LLM RESPONSE CACHE
// Caches LLM analysis results (patent analysis, sector classification, etc.)
// =============================================================================

model LlmResponseCache {
  id            Int       @id @default(autoincrement())

  // Request identification (composite unique key)
  promptType    String    @map("prompt_type") @db.VarChar(50)  // patent-analysis, sector-classification
  entityKey     String    @map("entity_key") @db.VarChar(100)  // patent_id or other identifier
  model         String    @db.VarChar(50)    // claude-sonnet-4-20250514, etc.

  // File reference (actual data on disk)
  filePath      String    @map("file_path") @db.VarChar(255)
  fileSize      Int?      @map("file_size")

  // Token tracking (useful for cost estimation)
  inputTokens   Int?      @map("input_tokens")
  outputTokens  Int?      @map("output_tokens")

  // Timestamps
  createdAt     DateTime  @default(now()) @map("created_at")

  @@unique([promptType, entityKey, model])
  @@index([promptType])
  @@map("llm_response_cache")
}
